# Netflix

Next.js, React Query, Supabase, Jotaië¥¼ í™œìš©í•œ Netflix í´ë¡  WebAppì…ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥

### ğŸ¯ í•µì‹¬ ê¸°ëŠ¥

- ì˜í™” ê²€ìƒ‰ ë° íƒìƒ‰: ë‹¤ì–‘í•œ ì˜í™” ê²€ìƒ‰ ë° ë¸Œë¼ìš°ì§•
- ë¬´í•œ ìŠ¤í¬ë¡¤: íš¨ìœ¨ì ì¸ ì˜í™” ëª©ë¡ ë¡œë”©
- ì‚¬ìš©ì ì¸ì¦: ì´ë©”ì¼ ê¸°ë°˜ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸
- ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥: ë¡œê·¸ì¸ ì‚¬ìš©ìë¥¼ ìœ„í•œ ì˜í™” ì¦ê²¨ì°¾ê¸° ì¶”ê°€/ì œê±°

### ğŸ›  ê¸°ìˆ  êµ¬í˜„

**ì•„í‚¤í…ì²˜**

- **ëª¨ë…¸ë ˆí¬ êµ¬ì¡°**:
  - ê³µìœ  UI ì»´í¬ë„ŒíŠ¸ (@next-inflearn/ui)
  - ê³µìœ  Supabase í´ë¼ì´ì–¸íŠ¸ (@next-inflearn/supabase)
  - Netflix ì• í”Œë¦¬ì¼€ì´ì…˜ (apps/netflix)
    **í”„ë¡ íŠ¸ì—”ë“œ**
- **ìƒíƒœ ê´€ë¦¬**:
  - Jotai: ê²½ëŸ‰í™”ëœ ì „ì—­ ìƒíƒœ ê´€ë¦¬
  - ê²€ìƒ‰ì–´, ë¡œê·¸ì¸ ëª¨ë‹¬, ì‚¬ìš©ì ì •ë³´ ìƒíƒœ ê´€ë¦¬
- **React Query í†µí•©**:
  - ë¬´í•œ ìŠ¤í¬ë¡¤ì„ ìœ„í•œ useInfiniteQuery í™œìš©
  - íš¨ìœ¨ì ì¸ ë°ì´í„° í˜ì¹­ ë° ìºì‹±
  - ì„œë²„ ìƒíƒœì™€ í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ë¶„ë¦¬
    **ë°±ì—”ë“œ**
- **Supabase í†µí•©**:
  - ì‚¬ìš©ì ì¸ì¦ (ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸)(profile table)
  - ì˜í™” ë°ì´í„° ê´€ë¦¬
  - ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ êµ¬í˜„(favorite table)
- **ì„œë²„ ì•¡ì…˜**:
  - ì˜í™” ê²€ìƒ‰ ë° í•„í„°ë§
  - ì¦ê²¨ì°¾ê¸° ì¶”ê°€/ì œê±°
  - ì‚¬ìš©ì í”„ë¡œí•„ ê´€ë¦¬
    **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„**
- **ì˜í™” í…Œì´ë¸”**: ì˜í™” ì •ë³´ ì €ì¥
- **í”„ë¡œí•„ í…Œì´ë¸”**: ì‚¬ìš©ì ë‹‰ë„¤ì„ ë° ì´ë©”ì¼ ì •ë³´
- **ì¦ê²¨ì°¾ê¸° í…Œì´ë¸”**: ì‚¬ìš©ì-ì˜í™” ê°„ ë‹¤ëŒ€ë‹¤ ê´€ê³„ ê´€ë¦¬
- **íŠ¸ë¦¬ê±°**: íšŒì›ê°€ì… ì‹œ ìë™ í”„ë¡œí•„ ìƒì„±

## ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë ˆì„ì›Œí¬**: Next.js 14 (App Router)
- **ì–¸ì–´**: TypeScript
- **ìŠ¤íƒ€ì¼ë§**: Tailwind CSS + ShadCn UI
- **ìƒíƒœ ê´€ë¦¬**: Jotai + React Query
- **ë°ì´í„°ë² ì´ìŠ¤**: Supabase
- **ì¸ì¦**: Supabase Auth
- **íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €**: pnpm
- **ëª¨ë…¸ë ˆí¬ ë„êµ¬**: Turborepo

## ETC

### DB Schema( movie / favorite / profile í…Œì´ë¸”)

```sql
create table movie (
  id int8 generated by default as identity primary key,
  image_url text,
  title varchar,
  overview varchar,
  vote_average float8,
  popularity float8,
  release_date varchar,
  inserted_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

```sql
-- favorites í…Œì´ë¸” ìƒì„±
create table favorites (
-- ìë™ ì¦ê°€í•˜ëŠ” ê³ ìœ  ID (primary key)
id bigint generated by default as identity primary key,

-- ì‚¬ìš©ì ID (auth.users í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤)
user_id uuid references auth.users(id) on delete cascade,

-- ì˜í™” ID (movie í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤)
movie_id bigint references movie(id) on delete cascade,

-- ìƒì„± ì‹œê°„ (UTC ê¸°ì¤€, ìë™ ì„¤ì •)
created_at timestamp with time zone default timezone('utc'::text, now()) not null,

-- ì‚¬ìš©ì-ì˜í™” ì¡°í•©ì˜ ìœ ì¼ì„± ë³´ì¥
unique(user_id, movie_id)
);

-- ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ ì¸ë±ìŠ¤ ìƒì„±
create index favorites_user_id_idx on favorites(user_id);
create index favorites_movie_id_idx on favorites(movie_id);
```

```sql
-- profiles í…Œì´ë¸” ìƒì„± (users í…Œì´ë¸”ì€ Supabase Authê°€ ìë™ìœ¼ë¡œ ê´€ë¦¬)
create table public.profiles (
id uuid references auth.users on delete cascade not null primary key,
email text not null,
nickname text not null,
created_at timestamp with time zone default timezone('utc'::text, now()) not null,
updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- í”„ë¡œí•„ ìƒì„±ì„ ìœ„í•œ í•¨ìˆ˜
create function public.handle_new_user()
returns trigger
language plpgsql
security definer set search_path = public
as $$
begin
insert into public.profiles (id, email, nickname)
values (new.id, new.email, new.raw_user_meta_data->>'nickname');
return new;
end;

$$
;

-- íŠ¸ë¦¬ê±° ìƒì„±
create trigger on_auth_user_created
  after insert on auth.users
  for each row execute procedure public.handle_new_user();
$$
```
